if (typeof (CG) === "undefined") { CG = {}; }
CG.CompGoalFunctions = {
    calculateTotal: function (e) {
        var formContext = e.getFormContext();
        var percentage = formContext.getAttribute("azt_percentage").getValue();
        var amount = formContext.getAttribute("azt_amount").getValue();
        if (percentage !== null && amount !== null) {
            if (percentage === 0) {
                formContext.getAttribute("azt_total").setValue(0);
            }
            else {
                formContext.getAttribute("azt_total").setValue((percentage / 100) * amount);
            }
        }
    },
    cloneCompGoal: function (formContext) {
        formContext.ui.setFormNotification("Cloning...", "INFO", "Cloning");
        var recordId = formContext.data.entity.getId();
        recordId = recordId.replace('{', '').replace('}', '').toLowerCase();
        var serverURL = formContext.context.getClientUrl();
        var data = {

        };
        var req = new XMLHttpRequest();
        req.open("POST", serverURL + "/api/data/v9.1/azt_compgoaltypes(" + recordId +")/Microsoft.Dynamics.CRM.azt_CloneCompGoal", true);
        req.setRequestHeader("OData-MaxVersion", "4.0");
        req.setRequestHeader("OData-Version", "4.0");
        req.setRequestHeader("Accept", "application/json");
        req.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        req.onreadystatechange = function () {
            if (this.readyState === 4) {
                req.onreadystatechange = null;
                if (this.status === 200) {
                    var data = JSON.parse(this.response);
                    Xrm.Utility.openEntityForm("azt_compgoaltype", data.azt_compgoaltypeid);
                    Xrm.Page.ui.setFormNotification("The Comp Goal has been cloned!", "INFO", "CompPmtSuccess");
                } else {
                    Xrm.Utility.alertDialog(this.statusText);
                }
            }
        };
        req.send();
        //req.send(window.JSON.stringify(data));
    }
}